<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syllabus Matching Test Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .syllabus-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .chat-id {
            font-family: monospace;
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 3px;
            display: inline-block;
            margin: 5px 0;
        }
        .match {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .no-match {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .syllabus-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            background: #fafafa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Syllabus Matching Test Demo</h1>
        <p>Test how the deterministic chat ID system works with different syllabus inputs.</p>

        <div class="test-section">
            <h3>Test 1: Same Syllabus (Should Match)</h3>
            <p>Enter the same course information in both fields:</p>
            
            <div class="comparison">
                <div class="syllabus-card">
                    <h4>Syllabus A</h4>
                    <input type="text" id="classCode1" class="syllabus-input" placeholder="Class Code (e.g., MATH101)" value="MATH101">
                    <input type="text" id="university1" class="syllabus-input" placeholder="University (e.g., Stanford)" value="Stanford">
                    <input type="text" id="semester1" class="syllabus-input" placeholder="Semester (e.g., Fall)" value="Fall">
                    <input type="text" id="year1" class="syllabus-input" placeholder="Year (e.g., 2024)" value="2024">
                </div>
                
                <div class="syllabus-card">
                    <h4>Syllabus B</h4>
                    <input type="text" id="classCode2" class="syllabus-input" placeholder="Class Code (e.g., MATH101)" value="MATH101">
                    <input type="text" id="university2" class="syllabus-input" placeholder="University (e.g., Stanford)" value="Stanford">
                    <input type="text" id="semester2" class="syllabus-input" placeholder="Semester (e.g., Fall)" value="Fall">
                    <input type="text" id="year2" class="syllabus-input" placeholder="Year (e.g., 2024)" value="2024">
                </div>
            </div>
            
            <button onclick="testMatching()">Test Matching</button>
            <div id="result1" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 2: Different Syllabus (Should Not Match)</h3>
            <p>Enter different course information:</p>
            
            <div class="comparison">
                <div class="syllabus-card">
                    <h4>Syllabus C</h4>
                    <input type="text" id="classCode3" class="syllabus-input" placeholder="Class Code" value="CS101">
                    <input type="text" id="university3" class="syllabus-input" placeholder="University" value="MIT">
                    <input type="text" id="semester3" class="syllabus-input" placeholder="Semester" value="Spring">
                    <input type="text" id="year3" class="syllabus-input" placeholder="Year" value="2024">
                </div>
                
                <div class="syllabus-card">
                    <h4>Syllabus D</h4>
                    <input type="text" id="classCode4" class="syllabus-input" placeholder="Class Code" value="PHYS201">
                    <input type="text" id="university4" class="syllabus-input" placeholder="University" value="Harvard">
                    <input type="text" id="semester4" class="syllabus-input" placeholder="Semester" value="Fall">
                    <input type="text" id="year4" class="syllabus-input" placeholder="Year" value="2024">
                </div>
            </div>
            
            <button onclick="testDifferent()">Test Different</button>
            <div id="result2" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 3: Complex Syllabus Format</h3>
            <p>Test with real-world syllabus formats like "Syllabus MATH-2211 Fall 2025 CRN 84025_84026_84027":</p>
            
            <div class="comparison">
                <div class="syllabus-card">
                    <h4>Syllabus G (Complex Format)</h4>
                    <input type="text" id="classCode5" class="syllabus-input" value="MATH-2211">
                    <input type="text" id="university5" class="syllabus-input" value="University of California">
                    <input type="text" id="semester5" class="syllabus-input" value="Fall">
                    <input type="text" id="year5" class="syllabus-input" value="2025">
                </div>
                
                <div class="syllabus-card">
                    <h4>Syllabus H (Same Course, Different Format)</h4>
                    <input type="text" id="classCode6" class="syllabus-input" value="MATH2211">
                    <input type="text" id="university6" class="syllabus-input" value="university of california">
                    <input type="text" id="semester6" class="syllabus-input" value="FALL">
                    <input type="text" id="year6" class="syllabus-input" value="2025">
                </div>
            </div>
            
            <button onclick="testComplexFormat()">Test Complex Format</button>
            <div id="result3" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 4: Real Syllabus Title Parsing</h3>
            <p>Test with actual syllabus title formats - the system will automatically parse them:</p>
            
            <div class="comparison">
                <div class="syllabus-card">
                    <h4>Syllabus I (Full Title)</h4>
                    <input type="text" id="title7" class="syllabus-input" value="Syllabus MATH-2211 Fall 2025 CRN 84025_84026_84027" placeholder="Enter full syllabus title">
                    <input type="text" id="university7" class="syllabus-input" value="State University" placeholder="University (optional)">
                </div>
                
                <div class="syllabus-card">
                    <h4>Syllabus J (Different Format)</h4>
                    <input type="text" id="title8" class="syllabus-input" value="MATH2211 Spring 2025 University of California" placeholder="Enter full syllabus title">
                    <input type="text" id="university8" class="syllabus-input" value="" placeholder="University (optional)">
                </div>
            </div>
            
            <button onclick="testTitleParsing()">Test Title Parsing</button>
            <div id="result4" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 5: All Format Variations</h3>
            <p>Test various real-world syllabus formats:</p>
            
            <div class="comparison">
                <div class="syllabus-card">
                    <h4>Format A</h4>
                    <input type="text" id="title9" class="syllabus-input" value="CS 101A Fall 2024 Stanford University">
                </div>
                
                <div class="syllabus-card">
                    <h4>Format B</h4>
                    <input type="text" id="title10" class="syllabus-input" value="ENG_200_Winter_2025_CRN_12345">
                </div>
            </div>
            
            <button onclick="testAllFormats()">Test All Formats</button>
            <div id="result5" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Advanced syllabus parser that handles all formats
        function parseSyllabusTitle(title) {
            if (!title) return null;
            
            // Remove common prefixes and suffixes
            let cleanTitle = title
                .replace(/^(syllabus|course|class)\s*/i, '')
                .replace(/\s*(syllabus|course|class)$/i, '')
                .trim();
            
            // Extract class code (various formats)
            const classCodePatterns = [
                /([A-Z]{2,4}[-_]?\d{3,4}[A-Z]?)/i,  // MATH-2211, CS101A, ENG_200
                /([A-Z]{2,4}\s+\d{3,4}[A-Z]?)/i,    // MATH 2211, CS 101A
                /([A-Z]{2,4}\d{3,4}[A-Z]?)/i        // MATH2211, CS101A
            ];
            
            let classCode = null;
            for (const pattern of classCodePatterns) {
                const match = cleanTitle.match(pattern);
                if (match) {
                    classCode = match[1].toUpperCase().replace(/[-_\s]/g, '');
                    break;
                }
            }
            
            // Extract semester
            const semesterPatterns = [
                /(fall|spring|summer|winter|autumn)/i,
                /(f|s|su|w|a)\d{4}/i  // F2024, S2025, etc.
            ];
            
            let semester = null;
            for (const pattern of semesterPatterns) {
                const match = cleanTitle.match(pattern);
                if (match) {
                    const sem = match[1].toLowerCase();
                    if (sem.startsWith('f')) semester = 'fall';
                    else if (sem.startsWith('s') && sem.length > 1) semester = 'spring';
                    else if (sem.startsWith('su')) semester = 'summer';
                    else if (sem.startsWith('w')) semester = 'winter';
                    else if (sem.startsWith('a')) semester = 'autumn';
                    else semester = sem;
                    break;
                }
            }
            
            // Extract year
            const yearMatch = cleanTitle.match(/(\d{4})/);
            const year = yearMatch ? yearMatch[1] : null;
            
            // Extract university (look for common patterns)
            const universityPatterns = [
                /(university of [^,]+)/i,
                /([^,]+ university)/i,
                /(college of [^,]+)/i,
                /([^,]+ college)/i
            ];
            
            let university = null;
            for (const pattern of universityPatterns) {
                const match = cleanTitle.match(pattern);
                if (match) {
                    university = match[1].trim();
                    break;
                }
            }
            
            return {
                classCode,
                semester,
                year,
                university,
                originalTitle: title
            };
        }

        // Enhanced ID generation that handles all formats
        function generateClassChatId(syllabusData) {
            let classCode = syllabusData.classCode;
            let university = syllabusData.university;
            let semester = syllabusData.semester;
            let year = syllabusData.year;
            
            // If we have a title, try to parse it
            if (syllabusData.title && !classCode) {
                const parsed = parseSyllabusTitle(syllabusData.title);
                if (parsed) {
                    classCode = parsed.classCode || classCode;
                    university = parsed.university || university;
                    semester = parsed.semester || semester;
                    year = parsed.year || year;
                }
            }
            
            // Normalize and clean
            classCode = (classCode || 'unknown').toLowerCase().replace(/[^a-z0-9]/g, '');
            university = (university || 'unknown').toLowerCase().replace(/[^a-z0-9]/g, '-');
            semester = (semester || 'unknown').toLowerCase().replace(/[^a-z0-9]/g, '-');
            year = year || 'unknown';
            
            return `class-${classCode}-${university}-${semester}-${year}`;
        }

        function getSyllabusData(prefix) {
            const titleElement = document.getElementById(`title${prefix}`);
            const classCodeElement = document.getElementById(`classCode${prefix}`);
            const universityElement = document.getElementById(`university${prefix}`);
            const semesterElement = document.getElementById(`semester${prefix}`);
            const yearElement = document.getElementById(`year${prefix}`);
            
            return {
                title: titleElement ? titleElement.value : null,
                classCode: classCodeElement ? classCodeElement.value : null,
                university: universityElement ? universityElement.value : null,
                semester: semesterElement ? semesterElement.value : null,
                year: yearElement ? yearElement.value : null
            };
        }

        function testMatching() {
            const syllabus1 = getSyllabusData('1');
            const syllabus2 = getSyllabusData('2');
            
            const chatId1 = generateClassChatId(syllabus1);
            const chatId2 = generateClassChatId(syllabus2);
            
            const result = document.getElementById('result1');
            result.style.display = 'block';
            
            if (chatId1 === chatId2) {
                result.className = 'result match';
                result.innerHTML = `
                    <h4>✅ MATCH FOUND!</h4>
                    <p>Both syllabi will join the same chat:</p>
                    <div class="chat-id">${chatId1}</div>
                    <p><strong>Result:</strong> Users will be added to the same existing chat group.</p>
                `;
            } else {
                result.className = 'result no-match';
                result.innerHTML = `
                    <h4>❌ NO MATCH</h4>
                    <p>Different chat IDs:</p>
                    <div class="chat-id">${chatId1}</div>
                    <div class="chat-id">${chatId2}</div>
                    <p><strong>Result:</strong> Users will be in separate chat groups.</p>
                `;
            }
        }

        function testDifferent() {
            const syllabus3 = getSyllabusData('3');
            const syllabus4 = getSyllabusData('4');
            
            const chatId3 = generateClassChatId(syllabus3);
            const chatId4 = generateClassChatId(syllabus4);
            
            const result = document.getElementById('result2');
            result.style.display = 'block';
            
            if (chatId3 === chatId4) {
                result.className = 'result match';
                result.innerHTML = `
                    <h4>✅ MATCH FOUND!</h4>
                    <p>Both syllabi will join the same chat:</p>
                    <div class="chat-id">${chatId3}</div>
                `;
            } else {
                result.className = 'result no-match';
                result.innerHTML = `
                    <h4>❌ NO MATCH (Expected)</h4>
                    <p>Different chat IDs:</p>
                    <div class="chat-id">${chatId3}</div>
                    <div class="chat-id">${chatId4}</div>
                    <p><strong>Result:</strong> Users will be in separate chat groups (as expected).</p>
                `;
            }
        }

        function testComplexFormat() {
            const syllabus5 = getSyllabusData('5');
            const syllabus6 = getSyllabusData('6');
            
            const chatId5 = generateClassChatId(syllabus5);
            const chatId6 = generateClassChatId(syllabus6);
            
            const result = document.getElementById('result3');
            result.style.display = 'block';
            
            if (chatId5 === chatId6) {
                result.className = 'result match';
                result.innerHTML = `
                    <h4>✅ MATCH FOUND!</h4>
                    <p>Different formatting (MATH-2211 vs MATH2211) normalized to same chat:</p>
                    <div class="chat-id">${chatId5}</div>
                    <p><strong>Result:</strong> The system handles formatting differences correctly.</p>
                `;
            } else {
                result.className = 'result no-match';
                result.innerHTML = `
                    <h4>❌ NO MATCH</h4>
                    <p>Different chat IDs:</p>
                    <div class="chat-id">${chatId5}</div>
                    <div class="chat-id">${chatId6}</div>
                    <p><strong>Result:</strong> Formatting differences prevent matching.</p>
                `;
            }
        }

        function testTitleParsing() {
            const syllabus7 = getSyllabusData('7');
            const syllabus8 = getSyllabusData('8');
            
            const chatId7 = generateClassChatId(syllabus7);
            const chatId8 = generateClassChatId(syllabus8);
            
            const result = document.getElementById('result4');
            result.style.display = 'block';
            
            // Show parsed data
            const parsed7 = parseSyllabusTitle(syllabus7.title);
            const parsed8 = parseSyllabusTitle(syllabus8.title);
            
            if (chatId7 === chatId8) {
                result.className = 'result match';
                result.innerHTML = `
                    <h4>✅ MATCH FOUND!</h4>
                    <p>Both titles parsed to the same course:</p>
                    <div class="chat-id">${chatId7}</div>
                    <p><strong>Parsed Data:</strong></p>
                    <p>Syllabus 1: ${parsed7.classCode} ${parsed7.semester} ${parsed7.year}</p>
                    <p>Syllabus 2: ${parsed8.classCode} ${parsed8.semester} ${parsed8.year}</p>
                `;
            } else {
                result.className = 'result no-match';
                result.innerHTML = `
                    <h4>❌ NO MATCH</h4>
                    <p>Different chat IDs:</p>
                    <div class="chat-id">${chatId7}</div>
                    <div class="chat-id">${chatId8}</div>
                    <p><strong>Parsed Data:</strong></p>
                    <p>Syllabus 1: ${parsed7.classCode} ${parsed7.semester} ${parsed7.year}</p>
                    <p>Syllabus 2: ${parsed8.classCode} ${parsed8.semester} ${parsed8.year}</p>
                `;
            }
        }

        function testAllFormats() {
            const syllabus9 = getSyllabusData('9');
            const syllabus10 = getSyllabusData('10');
            
            const chatId9 = generateClassChatId(syllabus9);
            const chatId10 = generateClassChatId(syllabus10);
            
            const result = document.getElementById('result5');
            result.style.display = 'block';
            
            // Show parsed data
            const parsed9 = parseSyllabusTitle(syllabus9.title);
            const parsed10 = parseSyllabusTitle(syllabus10.title);
            
            result.className = 'result no-match';
            result.innerHTML = `
                <h4>📋 PARSING RESULTS</h4>
                <p><strong>Format A:</strong> "${syllabus9.title}"</p>
                <p>Parsed: ${parsed9.classCode} ${parsed9.semester} ${parsed9.year} ${parsed9.university}</p>
                <div class="chat-id">${chatId9}</div>
                
                <p><strong>Format B:</strong> "${syllabus10.title}"</p>
                <p>Parsed: ${parsed10.classCode} ${parsed10.semester} ${parsed10.year}</p>
                <div class="chat-id">${chatId10}</div>
                
                <p><strong>Result:</strong> Different courses = different chats (as expected)</p>
            `;
        }

        // Auto-test on page load
        window.onload = function() {
            setTimeout(() => {
                testMatching();
                testDifferent();
                testComplexFormat();
                testTitleParsing();
                testAllFormats();
            }, 500);
        };
    </script>
</body>
</html>
