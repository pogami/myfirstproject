<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Syllabus Processing Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .syllabus-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .extracted-data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        .data-item {
            background: #f0f8ff;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #007bff;
        }
        .data-label {
            font-weight: bold;
            color: #333;
            font-size: 12px;
            text-transform: uppercase;
        }
        .data-value {
            font-size: 14px;
            margin-top: 5px;
        }
        .confidence {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .confidence.high { background: #d4edda; color: #155724; }
        .confidence.medium { background: #fff3cd; color: #856404; }
        .confidence.low { background: #f8d7da; color: #721c24; }
        .match-result {
            background: #e8f5e8;
            border-left-color: #28a745;
        }
        .no-match {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .syllabus-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            background: #fafafa;
        }
        .similarity-score {
            font-size: 18px;
            font-weight: bold;
            color: #28a745;
        }
        .match-reason {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧠 Advanced Syllabus Processing Test</h1>
        <p>Test the complete syllabus processing pipeline with AI-enhanced matching.</p>

        <div class="test-section">
            <h3>Test 1: Real Syllabus Text Processing</h3>
            <p>Paste actual syllabus text to test extraction and matching:</p>
            
            <textarea id="syllabusText1" class="syllabus-input" rows="8" placeholder="Paste syllabus text here...">Course: CSCI 1301 - Introduction to Computer Science
Instructor: Dr. Jane Smith (jane.smith@university.edu)
Semester: Fall 2024
University: Georgia State University
Department: Computer Science

Course Description:
This course introduces fundamental concepts of computer science including programming, algorithms, and data structures.

Prerequisites: None
Credits: 3</textarea>
            
            <button onclick="testSyllabusProcessing()">Process Syllabus</button>
            <div id="result1" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 2: Multiple Syllabus Comparison</h3>
            <p>Compare two different syllabus formats:</p>
            
            <div class="comparison">
                <div class="syllabus-card">
                    <h4>Syllabus A (Formal Format)</h4>
                    <textarea id="syllabusText2" class="syllabus-input" rows="6">MATH 2211 - Calculus I
Instructor: Prof. John Doe
Fall 2024
University of California, Berkeley
Department of Mathematics</textarea>
                </div>
                
                <div class="syllabus-card">
                    <h4>Syllabus B (Informal Format)</h4>
                    <textarea id="syllabusText3" class="syllabus-input" rows="6">Calculus I - MATH2211
Prof. J. Doe
F2024
UC Berkeley
Math Dept</textarea>
                </div>
            </div>
            
            <button onclick="testSyllabusComparison()">Compare Syllabi</button>
            <div id="result2" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 3: Complex Syllabus Format</h3>
            <p>Test with messy, real-world syllabus format:</p>
            
            <textarea id="syllabusText4" class="syllabus-input" rows="10" placeholder="Paste complex syllabus text...">Syllabus
BIO 101 - Introduction to Biology
CRN: 12345, 12346, 12347
Fall Semester 2024
Instructor: Dr. Sarah Johnson
Email: sarah.johnson@stateuniversity.edu
Office: Science Building, Room 205
University: State University of New York
Department: Biological Sciences

Course Overview:
This course provides an introduction to the fundamental principles of biology.</textarea>
            
            <button onclick="testComplexSyllabus()">Process Complex Syllabus</button>
            <div id="result3" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Test 4: Confidence Scoring</h3>
            <p>Test how confidence scores are calculated:</p>
            
            <div class="comparison">
                <div class="syllabus-card">
                    <h4>High Confidence</h4>
                    <textarea id="syllabusText5" class="syllabus-input" rows="4">CS 101 - Computer Science I
Dr. Alice Brown
Spring 2025
MIT</textarea>
                </div>
                
                <div class="syllabus-card">
                    <h4>Low Confidence</h4>
                    <textarea id="syllabusText6" class="syllabus-input" rows="4">Some course
Maybe 2024
Unknown university</textarea>
                </div>
            </div>
            
            <button onclick="testConfidenceScoring()">Test Confidence</button>
            <div id="result4" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Advanced syllabus processing functions
        function normalizeText(text) {
            return text
                .toLowerCase()
                .replace(/[^\w\s]/g, ' ')
                .replace(/\s+/g, ' ')
                .trim();
        }

        function extractSyllabusData(rawText) {
            const normalizedText = normalizeText(rawText);
            
            // Course code patterns
            const courseCodePatterns = [
                /(?:course\s+code|catalog\s+number|subject\s+code)[:\s]*([a-z]{2,4}[-_\s]?\d{3,4}[a-z]?)/i,
                /([a-z]{2,4}[-_\s]?\d{3,4}[a-z]?)/i,
                /(?:csci|cse|math|eng|bio|chem|phys|econ|hist|engl)[-_\s]?\d{3,4}[a-z]?/i
            ];
            
            // Course title patterns
            const courseTitlePatterns = [
                /(?:course\s+title|title)[:\s]*([^\n\r]+)/i,
                /(?:introduction\s+to|fundamentals\s+of|principles\s+of)\s+([^\n\r]+)/i,
                /([a-z\s]+(?:introduction|fundamentals|principles|basics|overview))/i
            ];
            
            // Instructor patterns
            const instructorPatterns = [
                /(?:instructor|professor|teacher)[:\s]*([^\n\r@]+)/i,
                /([a-z]+\s+[a-z]+)\s*@[a-z]+\.[a-z]+/i,
                /([a-z]+\s+[a-z]+)\s*\([a-z]+@[a-z]+\.[a-z]+\)/i
            ];
            
            // Email patterns
            const emailPatterns = [
                /([a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,})/gi
            ];
            
            // Semester patterns
            const semesterPatterns = [
                /(fall|spring|summer|winter|autumn)\s+(\d{4})/i,
                /(f|s|su|w|a)\s*(\d{4})/i,
                /(?:semester|term)[:\s]*(fall|spring|summer|winter|autumn)/i
            ];
            
            // University patterns
            const universityPatterns = [
                /(university\s+of\s+[^,\n\r]+)/i,
                /([^,\n\r]+\s+university)/i,
                /(college\s+of\s+[^,\n\r]+)/i,
                /([^,\n\r]+\s+college)/i
            ];
            
            // Department patterns
            const departmentPatterns = [
                /(?:department|school|division)\s+of\s+([^,\n\r]+)/i,
                /([^,\n\r]+\s+department)/i,
                /([^,\n\r]+\s+school)/i
            ];
            
            // Extract course code
            let courseCode = null;
            for (const pattern of courseCodePatterns) {
                const match = rawText.match(pattern);
                if (match) {
                    courseCode = match[1].toUpperCase().replace(/[-_\s]/g, '');
                    break;
                }
            }
            
            // Extract course title
            let courseTitle = null;
            for (const pattern of courseTitlePatterns) {
                const match = rawText.match(pattern);
                if (match) {
                    courseTitle = match[1].trim();
                    break;
                }
            }
            
            // Extract instructor
            let instructor = null;
            for (const pattern of instructorPatterns) {
                const match = rawText.match(pattern);
                if (match) {
                    instructor = match[1].trim();
                    break;
                }
            }
            
            // Extract email
            let instructorEmail = null;
            for (const pattern of emailPatterns) {
                const match = rawText.match(pattern);
                if (match) {
                    instructorEmail = match[1].toLowerCase();
                    break;
                }
            }
            
            // Extract semester and year
            let semester = null;
            let year = null;
            for (const pattern of semesterPatterns) {
                const match = rawText.match(pattern);
                if (match) {
                    const sem = match[1].toLowerCase();
                    if (sem.startsWith('f')) semester = 'fall';
                    else if (sem.startsWith('s') && sem.length > 1) semester = 'spring';
                    else if (sem.startsWith('su')) semester = 'summer';
                    else if (sem.startsWith('w')) semester = 'winter';
                    else if (sem.startsWith('a')) semester = 'autumn';
                    else semester = sem;
                    
                    year = match[2] || match[1].match(/\d{4}/)?.[0] || null;
                    break;
                }
            }
            
            // Extract university
            let university = null;
            for (const pattern of universityPatterns) {
                const match = rawText.match(pattern);
                if (match) {
                    university = match[1].trim();
                    break;
                }
            }
            
            // Extract department
            let department = null;
            for (const pattern of departmentPatterns) {
                const match = rawText.match(pattern);
                if (match) {
                    department = match[1].trim();
                    break;
                }
            }
            
            // Calculate confidence score
            const confidence = calculateConfidence({
                courseCode,
                courseTitle,
                instructor,
                semester,
                year,
                university
            });
            
            return {
                courseCode,
                courseTitle,
                instructor,
                instructorEmail,
                semester,
                year,
                university,
                department,
                rawText,
                confidence,
                extractedAt: Date.now()
            };
        }

        function calculateConfidence(data) {
            let score = 0;
            const maxScore = 6;
            
            if (data.courseCode) score += 1.5;
            if (data.courseTitle) score += 1;
            if (data.instructor) score += 1;
            if (data.semester) score += 0.5;
            if (data.year) score += 0.5;
            if (data.university) score += 1.5;
            
            return Math.min(score / maxScore, 1);
        }

        function createSyllabusSignature(data) {
            const signature = [
                data.courseCode || 'unknown',
                data.courseTitle || 'unknown',
                data.semester || 'unknown',
                data.year || 'unknown',
                data.university || 'unknown'
            ].join('|').toLowerCase().replace(/[^a-z0-9|]/g, '');
            
            return {
                id: `sig-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                courseCode: data.courseCode || 'unknown',
                courseTitle: data.courseTitle || 'unknown',
                semester: data.semester || 'unknown',
                year: data.year || 'unknown',
                university: data.university || 'unknown',
                signature,
                createdAt: Date.now()
            };
        }

        function calculateSimilarity(sig1, sig2) {
            const s1 = sig1.signature;
            const s2 = sig2.signature;
            
            if (s1 === s2) return 1.0;
            
            const set1 = new Set(s1.split('|'));
            const set2 = new Set(s2.split('|'));
            
            const intersection = new Set([...set1].filter(x => set2.has(x)));
            const union = new Set([...set1, ...set2]);
            
            return intersection.size / union.size;
        }

        function displayExtractedData(data, containerId) {
            const container = document.getElementById(containerId);
            container.style.display = 'block';
            
            const confidenceClass = data.confidence >= 0.8 ? 'high' : 
                                  data.confidence >= 0.6 ? 'medium' : 'low';
            
            container.innerHTML = `
                <h4>📋 Extracted Information</h4>
                <div class="extracted-data">
                    <div class="data-item">
                        <div class="data-label">Course Code</div>
                        <div class="data-value">${data.courseCode || 'Not detected'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Course Title</div>
                        <div class="data-value">${data.courseTitle || 'Not detected'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Instructor</div>
                        <div class="data-value">${data.instructor || 'Not detected'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Email</div>
                        <div class="data-value">${data.instructorEmail || 'Not detected'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">University</div>
                        <div class="data-value">${data.university || 'Not detected'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Department</div>
                        <div class="data-value">${data.department || 'Not detected'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Semester</div>
                        <div class="data-value">${data.semester || 'Not detected'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">Year</div>
                        <div class="data-value">${data.year || 'Not detected'}</div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <strong>Confidence Score: </strong>
                    <span class="confidence ${confidenceClass}">
                        ${Math.round(data.confidence * 100)}%
                    </span>
                </div>
            `;
        }

        function testSyllabusProcessing() {
            const text = document.getElementById('syllabusText1').value;
            const data = extractSyllabusData(text);
            displayExtractedData(data, 'result1');
        }

        function testSyllabusComparison() {
            const text1 = document.getElementById('syllabusText2').value;
            const text2 = document.getElementById('syllabusText3').value;
            
            const data1 = extractSyllabusData(text1);
            const data2 = extractSyllabusData(text2);
            
            const sig1 = createSyllabusSignature(data1);
            const sig2 = createSyllabusSignature(data2);
            
            const similarity = calculateSimilarity(sig1, sig2);
            
            const result = document.getElementById('result2');
            result.style.display = 'block';
            
            if (similarity >= 0.8) {
                result.className = 'result match-result';
                result.innerHTML = `
                    <h4>✅ HIGH MATCH FOUND!</h4>
                    <div class="similarity-score">${Math.round(similarity * 100)}% Similarity</div>
                    <div class="match-reason">
                        <strong>Match Reason:</strong> Both syllabi represent the same course with different formatting.
                    </div>
                    <p><strong>Result:</strong> Users will be added to the same study group.</p>
                `;
            } else if (similarity >= 0.6) {
                result.className = 'result';
                result.innerHTML = `
                    <h4>⚠️ MEDIUM MATCH</h4>
                    <div class="similarity-score">${Math.round(similarity * 100)}% Similarity</div>
                    <p><strong>Result:</strong> Manual confirmation recommended.</p>
                `;
            } else {
                result.className = 'result no-match';
                result.innerHTML = `
                    <h4>❌ LOW MATCH</h4>
                    <div class="similarity-score">${Math.round(similarity * 100)}% Similarity</div>
                    <p><strong>Result:</strong> Different courses - separate study groups.</p>
                `;
            }
        }

        function testComplexSyllabus() {
            const text = document.getElementById('syllabusText4').value;
            const data = extractSyllabusData(text);
            displayExtractedData(data, 'result3');
        }

        function testConfidenceScoring() {
            const text1 = document.getElementById('syllabusText5').value;
            const text2 = document.getElementById('syllabusText6').value;
            
            const data1 = extractSyllabusData(text1);
            const data2 = extractSyllabusData(text2);
            
            const result = document.getElementById('result4');
            result.style.display = 'block';
            
            result.innerHTML = `
                <h4>📊 Confidence Score Comparison</h4>
                <div class="comparison">
                    <div class="syllabus-card">
                        <h5>High Confidence Example</h5>
                        <div class="extracted-data">
                            <div class="data-item">
                                <div class="data-label">Course Code</div>
                                <div class="data-value">${data1.courseCode || 'Not detected'}</div>
                            </div>
                            <div class="data-item">
                                <div class="data-label">Instructor</div>
                                <div class="data-value">${data1.instructor || 'Not detected'}</div>
                            </div>
                            <div class="data-item">
                                <div class="data-label">University</div>
                                <div class="data-value">${data1.university || 'Not detected'}</div>
                            </div>
                        </div>
                        <div class="confidence ${data1.confidence >= 0.8 ? 'high' : data1.confidence >= 0.6 ? 'medium' : 'low'}">
                            ${Math.round(data1.confidence * 100)}% Confidence
                        </div>
                    </div>
                    
                    <div class="syllabus-card">
                        <h5>Low Confidence Example</h5>
                        <div class="extracted-data">
                            <div class="data-item">
                                <div class="data-label">Course Code</div>
                                <div class="data-value">${data2.courseCode || 'Not detected'}</div>
                            </div>
                            <div class="data-item">
                                <div class="data-label">Instructor</div>
                                <div class="data-value">${data2.instructor || 'Not detected'}</div>
                            </div>
                            <div class="data-item">
                                <div class="data-label">University</div>
                                <div class="data-value">${data2.university || 'Not detected'}</div>
                            </div>
                        </div>
                        <div class="confidence ${data2.confidence >= 0.8 ? 'high' : data2.confidence >= 0.6 ? 'medium' : 'low'}">
                            ${Math.round(data2.confidence * 100)}% Confidence
                        </div>
                    </div>
                </div>
                <p><strong>Note:</strong> Higher confidence scores indicate more complete and reliable course information extraction.</p>
            `;
        }

        // Auto-test on page load
        window.onload = function() {
            setTimeout(() => {
                testSyllabusProcessing();
                testSyllabusComparison();
                testComplexSyllabus();
                testConfidenceScoring();
            }, 500);
        };
    </script>
</body>
</html>
